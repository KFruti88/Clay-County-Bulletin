<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Clay County Bulletin</title>
    <style>
        .clay-county-news-box { width: 90%; max-width: 500px; margin: 20px auto; padding: 25px; border: 1px solid #222; background-color: #fffdf5; box-shadow: 6px 6px 0px #222; font-family: Arial, sans-serif; }
        .calendar-header { text-align: center; border-top: 4px solid #222; border-bottom: 2px solid #222; padding: 10px 0; margin-bottom: 20px; }
        .section-label { font-family: "Times New Roman", serif; font-weight: bold; text-transform: uppercase; font-size: 12px; color: #666; margin-bottom: 10px; border-bottom: 1px solid #ccc; display: block; }
        .event-entry { display: flex; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px dashed #999; }
        .event-date-box { min-width: 70px; text-align: center; padding: 10px 5px; margin-right: 20px; border: 1px solid #222; background-color: #eee; }
        .event-day { font-size: 22px; font-weight: bold; display: block; line-height: 1; }
        .event-month { font-size: 11px; text-transform: uppercase; font-weight: bold; }
        .event-info h4 { font-family: "Times New Roman", serif; font-size: 18px; margin: 0; color: #222; font-weight: bold; }
        .event-meta { font-size: 11px; text-transform: uppercase; display: block; color: #666; font-weight: bold; margin-bottom: 5px; }
        .report-link { display: block; text-align: center; padding: 10px; border: 1px dashed #eb1c24; color: #eb1c24; text-decoration: none; font-weight: bold; font-size: 13px; margin-top: 10px; }
        
        /* Town Colors */
        .flora-theme .event-date-box { background-color: #fe4f00; color: #0c0b82; }
        .louisville-theme .event-date-box { background-color: #eb1c24; color: #010101; }
        .clay-city-theme .event-date-box { background-color: #8a8a88; color: #0c30f0; }

        @media (max-width: 600px) { .clay-county-news-box { width: 95%; } }
    </style>
</head>
<body>

<div class="clay-county-news-box">
    <div class="calendar-header">
        <h2 style="text-align:center; font-family: 'Times New Roman', serif; text-transform: uppercase; margin: 0;">Clay County Bulletin</h2>
    </div>

    <span class="section-label" style="color: #eb1c24; border-bottom: 2px solid #eb1c24;">Public Safety Alerts</span>
    <div id="safety-target"></div>
    <a href="https://forms.gle/MTx4rePosdFDbfgx9" target="_blank" class="report-link">⚠️ Report a Hazard</a>

    <span class="section-label" style="margin-top:25px;">Upcoming Schedule</span>
    <div id="calendar-target">
        </div>
</div>

<script>
    const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRaeffFYYrzXJ9JXdmkynl5JbkvWZJusl812_NZuX63o6DynnJwC8G3AxiZLfoh5QGyr2Kys2mVioN7/pub?gid=670653122&single=true&output=csv";

    fetch(SHEET_URL).then(r => r.text()).then(csv => {
        const rows = csv.split('\n').slice(1);
        let html = "";
        const now = new Date();
        rows.forEach(row => {
            const cols = row.split(',');
            if (cols.length > 1) {
                const entryTime = new Date(cols[0]).getTime();
                if ((now - entryTime) < (24 * 60 * 60 * 1000)) {
                    html += `<div class="event-entry" style="border-left: 5px solid #eb1c24; background: #fff5f5; padding: 10px;">
                        <div class="event-info"><span class="event-meta" style="color:#eb1c24;">⚠️ ${cols[1]}</span><h4>${cols[2]}</h4></div>
                    </div>`;
                }
            }
        });
        document.getElementById('safety-target').innerHTML = html || "<p style='font-size:12px; color:#999;'>No active alerts.</p>";
    });
</script>
</body>
</html>
